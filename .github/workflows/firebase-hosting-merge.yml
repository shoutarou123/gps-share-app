# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge # workflowsの名前
on: # workflowがﾄﾘｶﾞｰされるｲﾍﾞﾝﾄを指定
  push: # workflowがpushによってﾄﾘｶﾞｰされる
    branches: # workflowが特定のbranchによって実行される
      - main # workflowがmain branchにpushされたときに実行される
jobs: # workflowで実行されるjobを定義
  build_and_deploy: # jobのnameをbuild_and_deployとしている
    runs-on: ubuntu-latest # jobが実行される環境をubuntuの最新ﾊﾞｰｼﾞｮﾝとしている
    steps: # job内で実行されるｽﾃｯﾌﾟを定義
      - uses: actions/checkout@v4 # GitHub repositoryのcodeをlocalにdownloadしてworkflowで使用できるようにする。versionはv4
      
      # .envﾌｧｲﾙを作成
      - name: Set up .env file
        run: |
          echo "VITE_SUPABASE_URL=${{ secrets.VITE_SUPABASE_URL }}" >> .env
          echo "VITE_SUPABASE_ANON_KEY=${{ secrets.VITE_SUPABASE_ANON_KEY }}" >> .env

      - run: npm ci && npm run build # npm ci で依存関係をinstallし、npm run buildでprojectをbuildする
      
      - uses: FirebaseExtended/action-hosting-deploy@v0 # Firebase Hostingにdeployするためのactionを使用。versionはv0
        with: # actionに渡すparameterを指定
          repoToken: ${{ secrets.GITHUB_TOKEN }} # GigHub repositoryのtokenを使用。tokenはGiHubのｼｰｸﾚｯﾄに保存されている
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_JISOU_TASK }} # Firebaseのserves acountを使用。serves acountの情報はGitHubのｼｰｸﾚｯﾄに保存されている
          channelId: live # deployするchannelDをliveとする
          projectId: jisou-task # Firebase projectIDを[jisou-task]とする

# channelId: liveは、Firebase Hostingの「live」チャネルにデプロイすることを指定する。
# 「live」チャネルとは、一般にアクセス可能なプロダクション環境を指し、デプロイされたコンテンツが直接ユーザーに公開される。
